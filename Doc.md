# Документация

# Классы

![](https://github.com/Di-Gro/TileVikings/blob/3294db30826c0a335f963050257a5a658c11aa62/Docs/bps.png)

# BE_Type
Описывают типы игровых объектов. Используются для различения объектов без знания их классов.

#### MapObjectType 
Типы иных объектов на клетках {Домик, Верфь}

### PlayerType
Типы игроков {Игрок, Противник} 

### TileType
Типы клеток (рельефа) {Холм, Равнина, Лес}

### UnitType
Типы юнитов {Легкая пехота, Тяжелая пехота, Копейщики, Лучники}

# BFL_
Библиотеки функций

# BML_
Библиотеки макросов

# BP_M_
Классы модели (Mvc), используются моделью и не могут быть инстанцированы на сцене. Наслудуются от Object.<br>
Инстанцируются TileMap, описывают состояние карты в runtime-е и используются для работы с ней. 

### M_MapObject (не реализован)

### M_Province
- index - индекс провинции в TileMapData
- onwer - тип игрока, которуму принадлежит провинция
- tiles - список тайлов, принадлежащих этой провинции

* Has Unit (PlayerType owner) - Возвращает true, если в провинции есть юниты owner-а
* Get Units (PlayerType owner)- Возвращает все юниты owner-а в провинции
* Get All Units () - Возвращает все юниты в провинции

### M_Tile
- index - индекс клетки в TileMapData. {x,y} - 2D координаты, {z} - 1D координаты
- type - тип местности в этой клетке
- active - true, если клетка помечена как активная
- unit - ссылка на юнит в этой клетке
- map object - ссылка на объект в этой клетке
- province - ссылка на провинцию, к которой принадлежит


* init ()
* Has Unit () - true, если в клетке есть юнит
* Has Object () - true, если в клетке есть объект
* Has Province () - true, если клетка принадлежит какой-либо провинции
* Is Active () - всегда true, если в TileMap не активирован режим активных клеток. Если активирован, то возвращает self.active
* Get Next (direction) - вызывает TileMap.GetNext() для себя. Возвращает соседнюю клетку в указанном направлении и ее валидность

Следующие методы уходят в TileMap и проводят к вызову событий, которые слушает TileMapView.
- Hilight (color) - сообщает, что нужно включить подсветку клетки указанным цветом
- Un Hilight () - сообщает, что нужно выключить подсветку
 
### M_Unit
- owner - игрок, которому принадлежит юнит
- type - тип юнита
- tile - ссылка на клетку, на которой находится юнит

* init ()

События
- Remove
- Move (path: list of tiles or world-space points)
- Attack
- Hilight(color)
- Un Hilight
 
# BP_
Классы, которые можно инстанцировать на сцене. Наследуются от Actor. 

### CameraController
Контроллер стратегической камеры. Нужно разместить на сцене, будет сам слушать ввод игрока. <br>
Использует InputActions: MoveCamera, RotateCamera, XAxis, YAxis, Scroll.

- Move To (position) - перемещает фокус камеры в указанную позицию.

### GameState
GameState. Реализует BPI_GameState. Предоставляяет "синглтоны". <br>
Принцип работы "синглтона" - при первом обращении, GameState ищет объект на сцене, запоминает его и возвращает.<br>
Текущие синглтоны: TileMap, TileMapView. 

- Get TileMap ()
- Get TileMapView ()

### InteractionManager
Управляет взаимодействием игрока с игровыми объектами. 
Слушает InteractionHelper для определения смены объекта взаимодействия (IInteractable). 
Управляет жизнью объекта управляющего взаимодействием (Interactor). 

### ProvinceBorder
Объект, рисующий границу провинции в мировом пространстве. 
- Set Points (list of points) - устанавливает точки, через которые пройдет граница провинции
- Generate Mesh () - создает меш границы провинции

### Spawner
Подписывается на события создания юнитов и объектов в TileMap, спавнит объекты нужных View-классов на сцене и вызывает Init(). 

### TileMap
Модель карты. Создает runtime описание карты из TileMapData инстанцируя, инициализируя и связывая все нужные model-объекты. Наследуется от BP_WAVBaseActor. Реализует BPI_TileMap. 

- Get Width () - ширина карты в клетках
- Get Height () - высота карты в клетках

* Create Object () - не реализован
* Remove Object () - не реализован

- Create Unit (tile, type, owner) - создает новый юнит в tile, вызывает событие UnitCreate
- Remove Unit (tile) - удаляет юнит, который сейчас находится в tile, вызывает событие RemoveUnit
- Swaap Units (path: list of tiles) - меняет местами ссылки на юниты в path.first и path.last. Если в клетках есть юниты, для них вызывается событие Move. Клиент должен убедиться, что оба юнита могут двигаться. 

* Get Tile (index) - возвращает tile по индексу
* Get Next (tile, direction) - Возвращает соседнюю клетку в указанном направлении и ее валидность
* Get Province (index) - возвращает province по индексу

- Start Active Mode (activeTiles: list of tiles) - запускает режим активных клеток, запоминает список и помечает каждую клетку в нем активной
- Stop Active Mode () - останавливает режим активных клеток, помечает каждую клетку в списке неактивной и очищает список активных клеток
- Has Active Mode () - true, если запущен режим активных клеток
- Get Active Tiles () - возвращает список активных клеток

* Find Tiles (tile, request) - ищет клетки, подходящие под запрос, посещая все соседние клетки начиная с tile. Если не ограничить запрос дистанцией или очками действия, пройдет по всей карте.
* Find Path (tile1, tile2) - не реализован - ищет путь между двумя клеткаими
* Find Available Path (tile1, tile2) - не реализован - ищет путь между двумя клеткаими, который будет доступен для движения юнита

- Hilight Tile (tile, color) - сообщает что нужно включить подсветку клетки. Вызывает событие TileHilight
- Un Hilight Tile (tile) - сообщает что нужно выключить подсветку клетки. Вызывает событие TileUnHilight


### TileMapView
Представление карты. Создает визуализацию карту из TileMapData, управляет подсветкой клеток и подсветкой границ провинций. Наследуется от BP_WAVBaseActor. Реализует BPI_TileMapView. Подписывается на TileMap, слушает события TileHilight, TileUnHilight, ActiveModeStart, ActiveModeStop. 

* tile map data - данные карты

- Init () - генерирует визуализацию карты из установленной tile map data
- Clear () - очищает все, что связано с визуализацией карты, TileMapView становится невалидным
- Bind Events (BPI_TileMap tilemap) - подписывает TileMapView на события TileMap, становится сonnected с этим TileMap
- Get Tile Size () - возвращает размер клетки в мировом пространстве
- Get Tile Position () - возвращает позицию центра клетки в мировом пространстве
- Is Connected () - true, если подписан на события TileMap

* Create Index (wpos) - создает индекс клетки для тукущей tile map data из мировой координаты

### TileMapEditor
Подключается к TileMapView и редактирует его tile map data. Может сгенерировать карту заданного размера и в runtime менять провинции и типы клеток. Чтобы сохранить результат, нужно в рантайме, после изменений, скопировать tile map data в TileMapView и вставить ее обратно уже в edittime. Слушает InputAction: EditorSelect - это LMB + Shift. 
<br>
Работает только в runtime.
<br>
Кнопки в редакторе:
- Generate Map Data - генерирует новую случайную TileMapData по заданным размерам карты. Перезаписывает данные в TileMapView. Если выполнять, то до Begin. 
- Begin - подключается к Target View и инициализирует себя. Выполнять два раза за один runtime нельзя. 
- Set Type - переходит в режим установки типа клетки. При EditorSelect назначает клетке тип из Tile Type. 
- Set Prov - переходит в режим установки принадлежности к провинции. При EditorSelect назначает клетке провинцию из Prov ID. 
- New Prov - создает новую провинцию, расширвет список провиций в tile map data.
- End - переходит в пустой режим, т.е. ничего не делает при EditorSelect.


### UnitInteractor (не реализован)
Управляет взаимодействием игрока с юнитом. Это все действия юнита - перемещение, атака, пропуск хода, сон, удаление.

 
